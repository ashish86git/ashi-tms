{% extends 'layout.html' %}

{% block content %}
<div class="container-fluid py-4">

    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <h2 class="fw-bolder text-dark"><i class="bi bi-bar-chart-line me-2 text-primary"></i> Performance Overview</h2>
        <p class="text-secondary mb-0 fw-medium">Fleet and Driver Efficiency Metrics</p>
    </div>

    <div class="alert alert-warning alert-dismissible fade show shadow-sm" role="alert">
        <strong>⚠️ DEMO DATA NOTICE:</strong> The graphs below are currently displaying **dummy data** for layout purposes. This dashboard is actively being customized and prepared for real-time data integration.
    </div>

    <div class="card p-3 mb-5 shadow-sm">
        <h6 class="card-title fw-bold text-secondary mb-3">Filter Performance Data</h6>
        <div class="row g-3">
            <div class="col-md-3 col-sm-6">
                <label for="vehicleFilter" class="form-label small fw-bold">Vehicle</label>
                <select id="vehicleFilter" class="form-select form-select-sm shadow-sm" aria-label="Select Vehicle">
                    <option value="">Select Vehicle</option>
                    {% for vehicle in vehicles %}
                        <option value="{{ vehicle.id }}">{{ vehicle.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3 col-sm-6">
                <label for="driverFilter" class="form-label small fw-bold">Driver</label>
                <select id="driverFilter" class="form-select form-select-sm shadow-sm" aria-label="Select Driver">
                    <option value="">Select Driver</option>
                    {% for driver in drivers %}
                        <option value="{{ driver.id }}">{{ driver.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3 col-sm-6">
                <label for="dateFilter" class="form-label small fw-bold">Date Range</label>
                <select id="dateFilter" class="form-select form-select-sm shadow-sm" aria-label="Select Date Filter">
                    <option value="single_date">Select Single Date</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                </select>
            </div>
            <div class="col-md-3 col-sm-6" id="singleDatePickerContainer">
                <label for="singleDate" class="form-label small fw-bold">Date</label>
                <input type="date" id="singleDate" class="form-control form-control-sm shadow-sm" aria-label="Select Date">
            </div>
        </div>
    </div>
    <div class="row g-4">

        <div class="col-lg-6">
            <div class="card glass-effect shadow-lg h-100 border-0">
                <div class="card-header bg-white border-bottom fw-bolder text-primary fs-5 d-flex align-items-center">
                    <i class="bi bi-truck-flatbed me-2"></i> Fleet Efficiency
                </div>
                <div class="card-body p-3">
                    <div id="fleet-performance-graph" style="height: 320px; width: 100%;"></div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card glass-effect shadow-lg h-100 border-0">
                <div class="card-header bg-white border-bottom fw-bolder text-success fs-5 d-flex align-items-center">
                    <i class="bi bi-person-badge me-2"></i> Driver Performance Score
                </div>
                <div class="card-body p-3">
                    <div id="driver-performance-graph" style="height: 320px; width: 100%;"></div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card glass-effect shadow-lg h-100 border-0">
                <div class="card-header bg-white border-bottom fw-bolder text-info fs-5 d-flex align-items-center">
                    <i class="bi bi-speedometer2 me-2"></i> Vehicle Total Distance
                </div>
                <div class="card-body p-3">
                    <div id="vehicle-distance-graph" style="height: 320px; width: 100%;"></div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card glass-effect shadow-lg h-100 border-0">
                <div class="card-header bg-white border-bottom fw-bolder text-warning fs-5 d-flex align-items-center">
                    <i class="bi bi-box-seam me-2"></i> Orders Assigned by Vehicle
                </div>
                <div class="card-body p-3">
                    <div id="vehicles-orders-graph" style="height: 320px; width: 100%;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    // --- Plotly Graph Generation (Dummy Data) ---
    // Fleet Performance (Bar Chart)
    Plotly.newPlot('fleet-performance-graph', [{
        x: ['Vehicle A', 'Vehicle B', 'Vehicle C', 'Vehicle D', 'Vehicle E'],
        y: [80, 70, 90, 75, 85],
        name: 'Efficiency Score',
        type: 'bar',
        marker: { color: '#007bff' }
    }], { title: 'Fleet Efficiency Score (Higher is Better)', margin: { t: 40, b: 50 }, xaxis: {title: 'Vehicle'}, yaxis: {title: 'Score (%)'} });

    // Driver Performance (Line Chart)
    Plotly.newPlot('driver-performance-graph', [{
        x: ['Driver 1', 'Driver 2', 'Driver 3', 'Driver 4', 'Driver 5'],
        y: [75, 85, 65, 90, 70],
        name: 'Performance Score',
        type: 'scatter',
        mode: 'lines+markers',
        line: { color: '#28a745', width: 3 }
    }], { title: 'Driver Performance Over Time/Comparison', margin: { t: 40, b: 50 }, xaxis: {title: 'Driver'}, yaxis: {title: 'Score (%)'} });

    // Vehicle Total Distance (Pie Chart)
    Plotly.newPlot('vehicle-distance-graph', [{
        labels: ['Vehicle A', 'Vehicle B', 'Vehicle C', 'Vehicle D', 'Vehicle E'],
        values: [1200, 900, 1500, 700, 1000],
        type: 'pie',
        hole: .4, // Donut Chart for better look
        marker: { colors: ['#00bcd4', '#009688', '#4caf50', '#8bc34a', '#ff9800'] }
    }], { title: 'Total Distance Covered by Vehicles', margin: { t: 40 } });

    // Vehicles vs Total Orders Assigned (Bar Chart)
    Plotly.newPlot('vehicles-orders-graph', [{
        x: ['Vehicle A', 'Vehicle B', 'Vehicle C', 'Vehicle D', 'Vehicle E'],
        y: [35, 40, 30, 25, 45],
        name: 'Orders Assigned',
        type: 'bar',
        marker: { color: '#ffc107' }
    }], { title: 'Total Orders Assigned per Vehicle', margin: { t: 40, b: 50 }, xaxis: {title: 'Vehicle'}, yaxis: {title: 'Total Orders'} });


    // --- Filter UI Logic (Existing Logic Maintained) ---
    const dateFilter = document.getElementById('dateFilter');
    const singleDatePickerContainer = document.getElementById('singleDatePickerContainer');
    const singleDateInput = document.getElementById('singleDate');

    // Initial check on load
    if (dateFilter.value === 'single_date') {
        singleDatePickerContainer.style.display = 'block';
    } else {
        singleDatePickerContainer.style.display = 'none';
    }

    dateFilter.addEventListener('change', function () {
        const show = this.value === 'single_date';
        singleDatePickerContainer.style.display = show ? 'block' : 'none';

        // Optional: Clear date input when switching away from single_date
        if (!show) {
            singleDateInput.value = '';
        }
    });

    // flatpickr initialization commented out/removed as per standard practice when not fully implementing date logic
    // flatpickr("#singleDate", { dateFormat: "Y-m-d", minDate: "today" });
</script>

<style>
    /* Custom glass effect for cards */
    .glass-effect {
        /* Adjusted gradient and added shadow for better effect */
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(241, 241, 241, 0.85));
        backdrop-filter: blur(10px);
        border-radius: 16px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .glass-effect:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15); /* Stronger shadow on hover */
    }

    /* Adjusting card-header style for better look */
    .card-header {
        background-color: #ffffff !important;
        border-bottom: 1px solid #dee2e6;
        padding: 1rem 1.25rem;
    }

    /* Small form select adjustment */
    .form-select-sm, .form-control-sm {
        height: calc(1.5em + 0.5rem + 2px);
    }
</style>
{% endblock %}