{% extends "layout.html" %}

{% block title %}Create Indent{% endblock %}

{% block content %}
<div class="container-fluid">

  {# ───────────────────────── Flash Messages / Success Modal ───────────────────── #}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
      {% if category == 'success' %}
        {# Success Modal remains for visual impact #}
        <button type="button" class="d-none" id="flashModalBtn" data-bs-toggle="modal" data-bs-target="#flashModal"></button>
        <div class="modal fade" id="flashModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="bi bi-check-circle-fill me-1"></i> Success</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">{{ message }}</div>
            </div>
          </div>
        </div>
        <script>
          // Ensure modal shows on page load if success flash message is present
          document.addEventListener('DOMContentLoaded',()=>{document.getElementById('flashModalBtn').click();});
        </script>
      {% else %}
        <div class="alert alert-{{ category }} alert-dismissible fade show mt-2" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endif %}
    {% endfor %}
  {% endwith %}

  {# ───────────────────────── Filter Card (UPDATED: Status Filter as Buttons) ──────────────────────────────── #}
  {% if indent_data %}
  <div class="card shadow mb-4 border-0">
    <div class="card-header bg-secondary text-white">
      <h5 class="mb-0"><i class="bi bi-funnel me-2"></i> Filter Indents</h5>
    </div>
    <div class="card-body">
      <div class="row g-3 align-items-end">
        {# Date Filter Remains #}
        <div class="col-md-4">
          <label class="form-label">Filter by **Indent Date**</label>
          <input type="date" id="filterIndentDate" class="form-control shadow-sm" />
        </div>

        {# Status Filter as Buttons (NEW UI) #}
        <div class="col-md-6">
          <label class="form-label d-block">Filter by Status</label>
          <div class="btn-group shadow-sm" role="group" id="filterStatusButtons">
            <button type="button" class="btn btn-primary active" data-status="">All Statuses</button>

            <button type="button" class="btn btn-outline-warning" data-status="loading">Loading</button>
            <button type="button" class="btn btn-outline-info" data-status="parking">Parking</button>
            <button type="button" class="btn btn-outline-success" data-status="exit">Exit Completed</button>
          </div>
        </div>

        {# Reset Button Remains #}
        <div class="col-md-2 d-flex align-items-end">
          <button type="button" class="btn btn-outline-danger w-100" id="filterReset">
            <i class="bi bi-x-circle me-1"></i> Reset Filters
          </button>
        </div>
      </div>
    </div>
  </div>
  {# ────────────────────────────────────────────────────────────────────────── #}

  {# ───────────────────────── Uploaded Indent Table ──────────────────────────────── #}
  <div class="card shadow mb-4 border-0">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="bi bi-table me-2"></i> All Submitted Indents</h5>
      <a href="{{ url_for('export_indents') }}" class="btn btn-light btn-sm">
        <i class="bi bi-file-earmark-arrow-down me-1"></i> Export to CSV
      </a>
    </div>
    <div class="card-body table-responsive">
      <table class="table table-striped table-bordered align-middle">
        <thead class="table-dark">
          <tr>
            {% for key in indent_data[0].keys() %}
              <th>{{ key.replace('_',' ').title() }}</th>
            {% endfor %}
            <th>Status</th> {# Status & Track combined in one column #}
          </tr>
        </thead>
        <tbody id="indentTableBody">
          {% for row in indent_data %}
          {# Added data-current-status for JS filtering #}
          <tr data-current-status="{{ row.current_status | default('none') }}">
            {% for key, value in row.items() %}
              <td>{{ value }}</td>
            {% endfor %}
            <td class="status-cell d-flex justify-content-between align-items-center">
              {# 1. Status Badge #}
              {% set status = row.current_status | default('none') %}
              <div>
                {% if status == 'exit' %}
                  <span class="badge bg-success">Exit Completed!</span>
                {% elif status == 'loading' %}
                  <span class="badge bg-warning text-dark">Loading</span>
                {% elif status == 'parking' %}
                  <span class="badge bg-primary">Parking</span>
                {% else %}
                  <span class="badge bg-secondary">Pending / Not Started</span>
                {% endif %}
              </div>

              {# 2. Track Button #}
              {% if row.current_status != 'exit' %}
                <button class="btn btn-outline-secondary btn-sm track-status-btn ms-2"
                        data-indent="{{ row['indent'] }}"
                        data-vehicle="{{ row['vehicle_number'] }}">
                  <i class="bi bi-truck"></i> Track
                </button>
              {% else %}
                <span class="text-muted small ms-2">N/A</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

  {# ───────────────────────── Upload Excel/CSV Card ──────────────────────────────── #}
  <div class="card shadow mb-4 border-0">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0"><i class="bi bi-upload me-2"></i> Upload Indent Excel/CSV</h5>
    </div>
    <div class="card-body">
      <form method="post" action="{{ url_for('upload_indent') }}" enctype="multipart/form-data">
        <div class="row g-3 align-items-end">
          <div class="col-md-6">
            <label class="form-label fw-semibold"><i class="bi bi-file-earmark-spreadsheet me-1"></i> File</label>
            <input type="file" name="file" accept=".xlsx,.xls,.csv" required class="form-control shadow-sm" />
          </div>
          <div class="col-md-6">
            <button type="submit" class="btn btn-info px-4">
              <i class="bi bi-upload me-1"></i> Upload
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  {# ───────────────────────── Master Model Shortcut ────────────────────── #}
  <div class="mb-4 text-end">
    <a href="{{ url_for('master_model') }}" class="btn btn-dark">
      <i class="bi bi-box-seam me-1"></i> Master Model
    </a>
  </div>

  {# ───────────────────────── Create New Indent ──────────────────────────── #}
  <div class="card shadow border-0">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0"><i class="bi bi-plus-circle me-2"></i> Create New Indent</h5>
    </div>
    <div class="card-body">
      <form method="post" class="row g-4">

        {# ── Indent General Info ── #}
        <div class="col-md-3">
          <label class="form-label">Indent Date</label>
          <input type="date" name="indent_date" id="indentDateInput" class="form-control shadow-sm" required />
        </div>
        <div class="col-md-3">
          <label class="form-label">Indent #</label>
          <input type="text" name="indent" class="form-control shadow-sm" required />
        </div>
        <div class="col-md-3">
          <label class="form-label">Allocation Date</label>
          <input type="date" name="allocation_date" id="allocationDateInput" class="form-control shadow-sm" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Pickup Location</label>
          <input type="text" name="pickup_location" value="Sonipat" required class="form-control shadow-sm" />
        </div>

        {# ───────────── Customer Sections ───────────── #}
        <div class="col-12 mt-3">
          <label class="form-label fw-semibold">Customer Details</label>
          <div id="customerSectionContainer">
            <div class="customer-block border rounded p-3 mb-3 shadow-sm">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="text-primary fw-semibold mb-0">Customer #1</h6>
                <button type="button" class="btn btn-outline-danger btn-sm removeCustomer d-none">
                  <i class="bi bi-trash"></i> Remove
                </button>
              </div>
              <div class="row g-3">
                <div class="col-md-3">
                  <label class="form-label">Customer Name</label>
                  <input type="text" name="customers[0][name]" class="form-control shadow-sm" required />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Range</label>
                  <select name="customers[0][range]" class="form-select shadow-sm" required>
                    <option value="">-- Select Range --</option>
                    <option value="0-100">0-100</option>
                    <option value="101-250">101-250</option>
                    <option value="251-400">251-400</option>
                    <option value="custom">Customize</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Drop Location</label>
                  <input type="text" name="customers[0][drop_location]" class="form-control shadow-sm" required />
                </div>
                <div class="col-md-3">
                  <label class="form-label">LR No.</label>
                  <input type="text" name="customers[0][lr_no]" class="form-control shadow-sm" />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Material</label>
                  <input type="text" name="customers[0][material]" class="form-control shadow-sm" />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Load per Bucket (Kg)</label>
                  <input type="number" name="customers[0][load_per_bucket]" class="form-control shadow-sm loadPerBucketInput" />
                </div>
                <div class="col-md-3">
                  <label class="form-label">No. Buckets</label>
                  <input type="number" name="customers[0][no_of_buckets]" class="form-control shadow-sm noOfBucketsInput" />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Total Load (Kg)</label>
                  <input type="number" name="customers[0][total_load]" class="form-control shadow-sm totalLoadInput" readonly />
                </div>
              </div>
            </div>
          </div>
          <div class="text-end">
            <button type="button" class="btn btn-outline-primary mt-2" id="addCustomerBtn">
              <i class="bi bi-plus-circle"></i> Add Another Customer
            </button>
          </div>
        </div>

        {# ───────────── Vehicle & Other Info ───────────── #}
        <div class="col-md-3">
          <label class="form-label">Vehicle Number</label>
          <select name="vehicle_number" required class="form-select shadow-sm">
            <option value="">-- Select Vehicle --</option>
            {% for v in fleet_data %}
              <option value="{{ v }}">{{ v }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Vehicle Model</label>
          <input type="text" name="vehicle_model" class="form-control shadow-sm" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Vehicle Based</label>
          <input type="text" name="vehicle_based" class="form-control shadow-sm" />
        </div>
        <div class="col-md-3">
          <label class="form-label">POD Received</label>
          <select name="pod_received" class="form-select shadow-sm">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Freight Tiger No.</label>
          <input type="text" name="freight_tiger_number" class="form-control shadow-sm" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Freight Tiger Month</label>
          <input type="month" name="freight_tiger_month" class="form-control shadow-sm" />
        </div>
        <div class="col-12 text-end">
          <button type="submit" class="btn btn-success px-5 mt-3">
            <i class="bi bi-plus-circle me-1"></i> Create Indent
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

{# ───────────────────── Vehicle Status Tracker Modal ───────────────────── #}
<div class="modal fade" id="statusModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-secondary text-white">
        <h5 class="modal-title"><i class="bi bi-truck me-2"></i> Vehicle Status Tracker: <span id="modalVehicleID" class="fw-bold"></span></h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h6 class="mb-3">Indent: <span id="modalIndentID" class="text-primary fw-bold"></span></h6>
        <div class="progress my-3" style="height: 28px;">
          <div id="statusProgress" class="progress-bar progress-bar-striped progress-bar-animated bg-info" style="width: 0%;">
            Waiting to Start...
          </div>
        </div>
        <div class="row text-center mt-4">
          <div class="col">
            <i class="bi bi-box2-fill fs-3 text-warning"></i>
            <p class="fw-semibold mb-0">Loading</p>
            <small id="loadTime">–</small>
          </div>
          <div class="col">
            <i class="bi bi-p-square-fill fs-3 text-primary"></i>
            <p class="fw-semibold mb-0">Parking</p>
            <small id="parkTime">–</small>
          </div>
          <div class="col">
            <i class="bi bi-door-open-fill fs-3 text-success"></i>
            <p class="fw-semibold mb-0">Ready to Exit</p>
            <small id="exitTime">–</small>
          </div>
        </div>
        <div class="text-center mt-4">
          <button class="btn btn-outline-warning me-2" id="btnLoading" data-status="loading"><i class="bi bi-box2"></i> Start Loading</button>
          <button class="btn btn-outline-primary me-2" id="btnParking" data-status="parking" disabled><i class="bi bi-p-square"></i> Move to Parking</button>
          <button class="btn btn-outline-success" id="btnExit" data-status="exit" disabled><i class="bi bi-door-open"></i> Ready to Exit</button>
        </div>
      </div>
    </div>
  </div>
</div>

{# ───────────────────────────── Optimized JavaScript Section ───────────────────────────── #}
<script>
document.addEventListener("DOMContentLoaded", function () {
    // ------------------- Date Default Logic -------------------
    const indentDateInput = document.getElementById('indentDateInput');
    const allocationDateInput = document.getElementById('allocationDateInput');

    function formatDate(date) {
        const yyyy = date.getFullYear();
        const mm = String(date.getMonth() + 1).padStart(2, '0'); // Months start at 0
        const dd = String(date.getDate()).padStart(2, '0');
        return `${yyyy}-${mm}-${dd}`;
    }

    if (indentDateInput) {
        const today = new Date();
        indentDateInput.value = formatDate(today);
    }

    if (allocationDateInput) {
        const nextWeek = new Date();
        nextWeek.setDate(nextWeek.getDate() + 7); // Add 7 days
        allocationDateInput.value = formatDate(nextWeek);
    }
    // ------------------- End Date Default Logic -------------------

  // --- DOM Elements for Status Tracker ---
  const statusModal = new bootstrap.Modal(document.getElementById("statusModal"));
  const progressBar = document.getElementById("statusProgress");
  const modalVehicleID = document.getElementById("modalVehicleID");
  const modalIndentID = document.getElementById("modalIndentID");
  const loadTime = document.getElementById("loadTime");
  const parkTime = document.getElementById("parkTime");
  const exitTime = document.getElementById("exitTime");
  const btnLoading = document.getElementById("btnLoading");
  const btnParking = document.getElementById("btnParking");
  const btnExit = document.getElementById("btnExit");
  const trackBtns = document.querySelectorAll(".track-status-btn");

  // --- Filtering DOM Elements (UPDATED) ---
  const filterIndentDateInput = document.getElementById("filterIndentDate");
  const filterStatusButtons = document.getElementById("filterStatusButtons"); // NEW: Button group container
  const filterResetBtn = document.getElementById("filterReset");
  const indentTableBody = document.getElementById("indentTableBody");

  // Variable to store the currently selected status filter value (from buttons)
  let currentStatusFilter = "";


  // --- Utility: Update Progress Bar and Buttons ---
  function updateModalUI(status, loadT, parkT, exitT) {
    let width = '0%', barClass = 'bg-info', barText = 'Waiting to Start...';
    let loadingDisabled = false, parkingDisabled = true, exitDisabled = true;

    if (status === "loading") {
      width = '33%';
      barClass = 'bg-warning';
      barText = 'Loading in Progress...';
      loadingDisabled = true;
      parkingDisabled = false;
    } else if (status === "parking") {
      width = '66%';
      barClass = 'bg-primary';
      barText = 'Vehicle Parked...';
      loadingDisabled = true;
      parkingDisabled = true;
      exitDisabled = false;
    } else if (status === "exit") {
      width = '100%';
      barClass = 'bg-success';
      barText = 'Exit Completed!';
      loadingDisabled = true;
      parkingDisabled = true;
      exitDisabled = true;
    }

    loadTime.textContent = loadT || "–";
    parkTime.textContent = parkT || "–";
    exitTime.textContent = exitT || "–";
    progressBar.style.width = width;
    progressBar.className = `progress-bar progress-bar-striped progress-bar-animated ${barClass}`;
    progressBar.textContent = barText;
    btnLoading.disabled = loadingDisabled;
    btnParking.disabled = parkingDisabled;
    btnExit.disabled = exitDisabled;
  }

  // --- API Call: Fetch Status ---
  async function fetchStatus(indent, vehicle) {
    const res = await fetch(`/get_status?indent=${indent}&vehicle=${vehicle}`);
    return res.json();
  }

  // --- API Call: Update Status ---
  async function updateStatus(status) {
    const indent = modalIndentID.textContent;
    const vehicle = modalVehicleID.textContent;
    const res = await fetch("/update_status", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ indent, vehicle, status }),
    });
    const data = await res.json();
    return data;
  }

  // --- Event: Track Button Click ---
  if (trackBtns) {
    trackBtns.forEach(btn => {
      btn.addEventListener("click", async () => {
        const indent = btn.getAttribute("data-indent");
        const vehicle = btn.getAttribute("data-vehicle");

        modalIndentID.textContent = indent;
        modalVehicleID.textContent = vehicle;

        // Reset and fetch status
        updateModalUI(null, null, null, null); // Initial reset
        const data = await fetchStatus(indent, vehicle);

        // Update UI based on fetched status
        updateModalUI(data.status, data.loading_time, data.parking_time, data.exit_time);

        statusModal.show();
      });
    });
  }

  // --- Event: Status Update Button Clicks (Delegated Handlers) ---
  if (btnLoading) {
    btnLoading.addEventListener("click", async () => {
      await updateStatus("loading");
      // Reload to update the status badge in the main table and re-apply filters if needed
      location.reload();
    });
  }

  if (btnParking) {
    btnParking.addEventListener("click", async () => {
      await updateStatus("parking");
      location.reload();
    });
  }

  if (btnExit) {
    btnExit.addEventListener("click", async () => {
      await updateStatus("exit");
      location.reload();
    });
  }


  // ------------------- Customer Form Logic (Unchanged) -------------------

  const container = document.getElementById("customerSectionContainer");
  const addBtn = document.getElementById("addCustomerBtn");

  function updateLabels() {
    const blocks = container.querySelectorAll(".customer-block");
    blocks.forEach((block, i) => {
      // Update title
      block.querySelector("h6").textContent = `Customer #${i + 1}`;
      // Update form names
      block.querySelectorAll("input, select").forEach(input => {
        const name = input.getAttribute("name");
        if (name) {
            input.setAttribute("name", name.replace(/\[\d+\]/, `[${i}]`));
        }
      });
      // Show remove button for all customers except the first one
      if (i > 0) {
        block.querySelector(".removeCustomer").classList.remove("d-none");
      } else {
        block.querySelector(".removeCustomer").classList.add("d-none");
      }
    });
  }

  if (container) {
    updateLabels();
  }

  if (addBtn) {
    addBtn.addEventListener("click", () => {
      const newBlock = container.firstElementChild.cloneNode(true);
      newBlock.querySelectorAll("input, select").forEach(input => { input.value = ""; });
      container.appendChild(newBlock);
      updateLabels();
    });
  }

  if (container) {
    container.addEventListener("click", e => {
      if (e.target.closest(".removeCustomer")) {
        e.target.closest(".customer-block").remove();
        updateLabels();
      }
    });

    container.addEventListener("input", e => {
      if (e.target.classList.contains("loadPerBucketInput") || e.target.classList.contains("noOfBucketsInput")) {
        const block = e.target.closest(".customer-block");
        const loadInput = block.querySelector(".loadPerBucketInput");
        const bucketsInput = block.querySelector(".noOfBucketsInput");
        const totalLoadInput = block.querySelector(".totalLoadInput");

        const load = parseFloat(loadInput.value) || 0;
        const buckets = parseFloat(bucketsInput.value) || 0;

        totalLoadInput.value = (load * buckets).toFixed(2);
      }
    });
  }

  // ───────────────────────────── Filtering Logic (UPDATED to use Buttons) ─────────────────────────────

  /**
   * Filters the table rows based on the Indent Date and status selection.
   */
  function filterTable() {
    if (!indentTableBody) return;

    const dateFilter = filterIndentDateInput.value.trim();
    // Use the global variable updated by button click
    const statusFilter = currentStatusFilter;

    const rows = indentTableBody.querySelectorAll("tr");

    rows.forEach(row => {
      const cells = row.querySelectorAll("td");
      let matchesDate = false;
      let matchesStatus = false;

      // Assuming 'indent_date' is the *first* data column in the table (index 0).
      const rowIndentDate = cells[0].textContent.trim();
      const rowStatus = row.getAttribute('data-current-status');

      // 1. Check Date Filter
      if (dateFilter === "") {
        matchesDate = true;
      } else {
        matchesDate = (rowIndentDate === dateFilter);
      }

      // 2. Check Status Filter (Logic remains the same)
      if (statusFilter === "") {
        matchesStatus = true; // All Statuses
      } else if (statusFilter === "track") {
        // 'Trackable' means any active status (loading or parking) or not yet started ('none')
        matchesStatus = (rowStatus === 'loading' || rowStatus === 'parking' || rowStatus === 'none');
      } else if (statusFilter === "exit") {
        // Show only rows that are completed
        matchesStatus = (rowStatus === 'exit');
      } else {
        // Filter for specific statuses (loading, parking)
        matchesStatus = (rowStatus === statusFilter);
      }

      // Show or hide the row
      if (matchesDate && matchesStatus) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }

  // Event Listeners for Filtering
  if (indentTableBody) {
    // 1. Date Filter
    filterIndentDateInput.addEventListener("change", filterTable);

    // 2. Status Button Filter (NEW Handler)
    if (filterStatusButtons) {
        filterStatusButtons.addEventListener("click", (e) => {
            const clickedButton = e.target.closest('button');
            if (clickedButton && clickedButton.dataset.status !== undefined) {
                // Update the current filter state
                currentStatusFilter = clickedButton.dataset.status;

                // Update active button styling
                filterStatusButtons.querySelectorAll('button').forEach(btn => {
                    btn.classList.remove('active', 'btn-primary', 'btn-outline-warning', 'btn-outline-info', 'btn-outline-success');
                    // Reset to outline primary or the appropriate outline class
                    if (btn.dataset.status === 'loading') {
                        btn.classList.add('btn-outline-warning');
                    } else if (btn.dataset.status === 'parking') {
                        btn.classList.add('btn-outline-info');
                    } else if (btn.dataset.status === 'exit') {
                        btn.classList.add('btn-outline-success');
                    } else {
                        btn.classList.add('btn-outline-primary');
                    }
                });

                // Set the clicked button as active, using the primary/filled style
                if (currentStatusFilter === 'loading') {
                    clickedButton.classList.remove('btn-outline-warning');
                    clickedButton.classList.add('btn-warning', 'active');
                } else if (currentStatusFilter === 'parking') {
                    clickedButton.classList.remove('btn-outline-info');
                    clickedButton.classList.add('btn-info', 'active');
                } else if (currentStatusFilter === 'exit') {
                    clickedButton.classList.remove('btn-outline-success');
                    clickedButton.classList.add('btn-success', 'active');
                } else {
                    clickedButton.classList.remove('btn-outline-primary');
                    clickedButton.classList.add('btn-primary', 'active');
                }

                // Apply the filter
                filterTable();
            }
        });
    }


    // 3. Reset Button
    filterResetBtn.addEventListener("click", () => {
      // Reset Date
      filterIndentDateInput.value = "";

      // Reset Status Buttons UI and Logic
      currentStatusFilter = "";
      filterStatusButtons.querySelectorAll('button').forEach(btn => {
          btn.classList.remove('active', 'btn-primary', 'btn-warning', 'btn-info', 'btn-success');
          if (btn.dataset.status === 'loading') {
              btn.classList.add('btn-outline-warning');
          } else if (btn.dataset.status === 'parking') {
              btn.classList.add('btn-outline-info');
          } else if (btn.dataset.status === 'exit') {
              btn.classList.add('btn-outline-success');
          } else {
              btn.classList.add('btn-primary'); // 'All Statuses' is the default active
          }
      });
      // Set 'All Statuses' button active again
      filterStatusButtons.querySelector('[data-status=""]').classList.add('active');


      filterTable(); // Apply the reset state
    });
  }
});
</script>

{% endblock %}